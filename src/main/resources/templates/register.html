<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xml:lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- Bootstrap Icons CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Font -->
    <link href="https://fonts.cdnfonts.com/css/public-pixel" rel="stylesheet">
</head>

<body>
<section>

    <form id="registerForm" th:action="@{/mealcraft/register}" method="post">
        <h2>Welcome to MealCraft</h2>
        <div class="input-box">
            <p>Username</p>
            <i class="bi bi-person"></i>
            <input type="text" name="username" th:value="${username}" required>
        </div>

        <div class="input-box">
            <p>Email</p>
            <i class="bi bi-person"></i>
            <input id="email" type="email" name="email" th:value="${email}" required
                   pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                   title="Please enter a valid email address">
        </div>
        <div class="input-box">
            <p>Password</p>
            <i class="bi bi-lock"></i>
            <input id="password" type="password" name="password" required>
        </div>

        <div class="input-box">
            <p>Type password again</p>
            <i class="bi bi-lock"></i>
            <input id="password2" type="password" name="password2" required>
        </div>
        <div class="error-box">
            <p th:if="${error}" th:text="${error}"></p>
        </div>

        <div class="client-error-box">
            <p id="clientError" style="color: #d9534f; display: none;"></p>
        </div>

        <button type="submit">Register</button>
        <div class="log-in">
            <p>Already have an account in MealCraft? <a href="/mealcraft/login">Login</a></p>
        </div>
    </form>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('registerForm');
        const pwd = document.getElementById('password');
        const pwd2 = document.getElementById('password2');
        const clientError = document.getElementById('clientError');
        const email = document.getElementById('email');

        if (!form || !pwd || !pwd2 || !clientError || !email) return;

        email.addEventListener('invalid', (e) => {
            email.setCustomValidity('Please enter a valid email address');
        });
        email.addEventListener('input', () => email.setCustomValidity(''));

        form.addEventListener('submit', function (e) {
            clientError.style.display = 'none';
            clientError.textContent = '';

            if (pwd.value !== pwd2.value) {
                e.preventDefault();
                clientError.textContent = 'Passwords do not match';
                clientError.style.display = 'block';
                pwd2.focus();
                return false;
            }

            if (pwd.value.length < 8) {
                e.preventDefault();
                clientError.textContent = 'Password must be at least 8 characters long';
                clientError.style.display = 'block';
                pwd.focus();
                return false;
            }

            return true;
        });
    });
</script>
</body>
</html>
